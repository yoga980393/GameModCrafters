@model GameModCrafters.Models.Transaction

@{
    ViewData["Title"] = "Details";
}


<div class="container my-4">
    <h2>交易細節</h2>
    <hr />
    <div class="row">
        <label class="col-sm-2" for="Commission">@Html.DisplayNameFor(model => model.Commission)</label>
        <div class="col-sm-10" id="Commission">
            <a href="/Commissions/Details/@Html.DisplayFor(model => model.Commission.CommissionId)">@Html.DisplayFor(model => model.Commission.CommissionTitle)</a>
        </div>

        <label class="col-sm-2" for="Describe">@Html.DisplayNameFor(model => model.Describe)</label>
        <div class="col-sm-10" id="Describe">
            @Html.DisplayFor(model => model.Describe)
        </div>

        <label class="col-sm-2" for="Budget">@Html.DisplayNameFor(model => model.Budget)</label>
        <div class="col-sm-10" id="Budget">
            @Html.DisplayFor(model => model.Budget) Mod Coin
        </div>

        <label class="col-sm-2" for="Payer">@Html.DisplayNameFor(model => model.Payer)</label>
        <div class="col-sm-10" id="Payer">
            @Html.DisplayFor(model => model.Payer.Username) (@Html.DisplayFor(model => model.Payer.Email))
        </div>

        <label class="col-sm-2" for="Payee">@Html.DisplayNameFor(model => model.Payee)</label>
        <div class="col-sm-10" id="Payee">
            @Html.DisplayFor(model => model.Payee.Username) (@Html.DisplayFor(model => model.Payee.Email))
        </div>

        <label class="col-sm-2" for="CreateTime">@Html.DisplayNameFor(model => model.CreateTime)</label>
        <div class="col-sm-10" id="CreateTime">
            @Html.DisplayFor(model => model.CreateTime)
        </div>
    </div>

    <div class="my-3">
        @if (!Model.IsConfirm)
        {
            if (@User.FindFirstValue(ClaimTypes.Email) == Model.PayerId)
            {
                <a class="btn btn-primary" asp-action="Edit" asp-route-id="@Model.TransactionId">修改細節</a>
                <a class="btn btn-danger" asp-action="Delete" asp-route-id="@Model.TransactionId">刪除此交易</a>
            }
            if (@User.FindFirstValue(ClaimTypes.Email) == Model.PayeeId)
            {
                if (Model.TransactionStatus)
                {
                    <a class="btn btn-primary" asp-action="SubmitFile" asp-route-id="@Model.TransactionId">提交成品</a>
                }
                else
                {
                    <button class="btn btn-primary" id="AcceptCommissionBtn">接受委託</button>
                }
            }
        }
        @if (Model.IsConfirm)
        {
            <div>成品：<a href="@Model.FileURL">下載</a></div>
        }
    </div>
</div>


@section js{
    <script>
        $("#AcceptCommissionBtn").on("click", () => {
            var transactionId = "@Model.TransactionId"; 
            $.ajax({
                url: '/Transactions/AcceptCommission',
                method: 'POST',
                data: { transactionId: transactionId },
                success: function (data) {
                    window.location.href = data;
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // 錯誤的處理
                }
            })
        })
    </script>
}