@model GameModCrafters.Models.Commission

@{
    ViewData["Title"] = "Details";
}

<div class="container  Entrustcontainer">
    <h1>委託修改</h1>
    <div class="row">
        <form method="post">
            <select asp-for="CommissionStatusId" class="form-control" asp-items="@ViewBag.CommissionStatusId" disabled></select>
            <select asp-for="DelegatorId" class="form-control" asp-items="@ViewBag.DelegatorId" disabled></select>
            <input type="hidden" class="form-control" asp-for="CommissionId" disabled>
            <div class="mb-3">
                <label asp-for="CommissionTitle" class="form-label">委託標題:</label>
                <input class="form-control" asp-for="CommissionTitle" disabled>
            </div>
            <div class="mb-3">
                <label asp-for="GameId" class="form-label">遊戲名稱:</label>
                <select asp-for="GameId" type="hidden" class="form-control" asp-items="@ViewBag.GameName" disabled></select>
            </div>
            <div class="mb-3">
                <label asp-for="CommissionDescription" class="form-label">委託詳情:</label>
                <dic class="CommissionDescription"></dic>
                <input asp-for="CommissionDescription" class="form-control" type="hidden" />
            </div>
            <div class="mb-3">
                <label asp-for="Budget">預算:</label>
                <input type="text" class="budgetinput" asp-for="Budget" disabled>
            </div>
            @*<div class="mb-3">
                <label asp-for="Trash">是否放入暫存匣:</label>
                <input type="checkbox" class="Trashinput" asp-for="Trash" disabled>
            </div>*@
            <div class="btnCantaner">
                @* <input type="submit" value="發布" asp-controller="Commissions" asp-action="Create" class="btn btn-primary form-control" />*@
                <input type="submit" value="修改" asp-controller="Commissions" asp-action="Edit" class="btn btn-primary form-control" />
                @*<input type="submit" value="儲存草稿" asp-controller="Commissions" asp-action="Details" class="btn btn-primary form-control" />*@
                <input type="submit" value="修改" asp-controller="Commissions" asp-action="Edit" class="btn btn-primary form-control" />
            </div>
        </form>
    </div>
</div>

@section css {
    <link rel="stylesheet" href="~/css/CommissionsDetails.css" />
}

@section js {


    <script src="https://cdn.ckeditor.com/ckeditor5/37.0.1/classic/ckeditor.js"></script>

    <script>

        let myEditor;
        $(.CommissionDescription).html(@Html.Raw(Model.CommissionDescription))

        ClassicEditor
            .create(document.querySelector('#editor'), {
                // ...other configurations,
                extraPlugins: [Base64UploadAdapterPlugin]
            })

            .then(editor => {
                myEditor = editor;
                myEditor.isReadOnly = true;
            })

            .catch(error => {
                console.error(error);
            });

        function Base64UploadAdapterPlugin(editor) {
            editor.plugins.get('FileRepository').createUploadAdapter = function (loader) {
                return new Base64UploadAdapter(loader);
            };
        }

        $(document).ready(function () {
            myEditor.setData($("#CommissionDescription").val());
        });

        class Base64UploadAdapter {
            constructor(loader) {
                this.loader = loader;
            }

            upload() {
                return this.loader.file
                    .then(file => new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = () => {
                            resolve({ default: reader.result });
                        };
                        reader.onerror = error => {
                            reject(error);
                        };
                        reader.readAsDataURL(file);
                    }));
            }

            abort() { }
        }


        $('form').on('submit', function (e) {
            // 在表單提交時，手動更新隱藏的 input 欄位的值
            $('#CommissionDescription').val(myEditor.getData());
        });


    </script>
}